/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.maya.portAuthority.util;

import com.maya.portAuthority.googleMaps.NearestStopLocator;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.Reader;
import java.net.URL;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 *
 * @author Adithya
 */
public class TinyURLGenerator {
    
    private static Logger log = LoggerFactory.getLogger(TinyURLGenerator.class);
    public static String getTinyURL(String urlToCompress){
        String api = "http://tinyurl.com/api-create.php?url=" + urlToCompress;//https://maps.googleapis.com/maps/api/staticmap?size=1200x800&maptype=roadmap&key=AIzaSyAOTkkr2SDnAQi8-fohOn4rUinICd-pHVA&format=png&visual_refresh=true&markers=size:mid%7Ccolor:0xff0000%7Clabel:1%7C40.46434789999999,-79.926266&markers=size:mid%7Ccolor:0xff0000%7Clabel:2%7C40.459440916034,-79.922839395502&path=color:0x0000ff|weight:5|40.46446,-79.92622|40.46446,-79.92622|40.46445,-79.92618|40.46445,-79.92618|40.46428,-79.92564|40.46428,-79.92564|40.46424,-79.92551|40.46424,-79.92551|40.46417,-79.92526|40.46417,-79.92526|40.46411,-79.92502|40.46411,-79.92502|40.46404,-79.92478|40.46404,-79.92478|40.46396,-79.92447|40.46396,-79.92447|40.46382,-79.92403|40.46382,-79.92403|40.46374,-79.92377|40.46374,-79.92377|40.46374,-79.92377|40.46374,-79.92377|40.46306,-79.92409|40.46306,-79.92409|40.46271,-79.92425|40.46271,-79.92425|40.4626,-79.9243|40.4626,-79.9243|40.46247,-79.92435|40.46247,-79.92435|40.46199,-79.92458|40.46199,-79.92458|40.46174,-79.92469|40.46174,-79.92469|40.46142,-79.92483|40.46142,-79.92483|40.46142,-79.92483|40.46142,-79.92483|40.46107,-79.92382|40.46107,-79.92382|40.46102,-79.92368|40.46102,-79.92368|40.46093,-79.92345|40.46093,-79.92345|40.46089,-79.92332|40.46089,-79.92332|40.46083,-79.92318|40.46083,-79.92318|40.46078,-79.92304|40.46078,-79.92304|40.46068,-79.92275|40.46068,-79.92275|40.46059,-79.92248|40.46059,-79.92248|40.46049,-79.92218|40.46049,-79.92218|40.46036,-79.92182|40.46036,-79.92182|40.46025,-79.92173|40.46025,-79.92173|40.46025,-79.92173|40.46025,-79.92173|40.46013,-79.92183|40.46013,-79.92183|40.46,-79.92193|40.46,-79.92193|40.45999,-79.92194|40.45999,-79.92194|40.45997,-79.92196|40.45997,-79.92196|40.45996,-79.92199|40.45996,-79.92199|40.45981,-79.92262|40.45981,-79.92262|40.45981,-79.92262|40.45981,-79.92262|40.45953,-79.92233|40.45953,-79.92233|40.45951,-79.92231|40.45951,-79.92231|40.45953,-79.92219|40.45953,-79.92219|40.4595,-79.92223|40.4595,-79.92223|40.45938,-79.92273|40.45938,-79.92273|40.45938,-79.92277|40.45938,-79.92277|40.45937,-79.92281|40.45937,-79.92281
        String tinyURL = null;
        if ( urlToCompress!=null || !urlToCompress.equals("")) {
            try {
               tinyURL = readStringFromUrl(api);
               tinyURL = tinyURL.replace("http:", "https:");
            } catch (IOException e1) {
                e1.printStackTrace();
            }
        }
        log.info("IMAGE TINY URL: "+tinyURL);
        return tinyURL;
    }
    
    private static String readAll(Reader rd) throws IOException {
        StringBuilder sb = new StringBuilder();
        int cp;
        while ((cp = rd.read()) != -1) {
            sb.append((char) cp);
        }
        return sb.toString();
    }

    public static String readStringFromUrl(String url) throws IOException {
        InputStream is = new URL(url).openStream();
        try {
            BufferedReader rd = new BufferedReader(new InputStreamReader(is));
            String jsonText = readAll(rd);
            return jsonText;    
        } finally {
            is.close();
        }
    }
    //test
    public static void main(String[] args){
        System.out.println(getTinyURL("https://maps.googleapis.com/maps/api/staticmap?size=1200x800&maptype=roadmap&key=AIzaSyAOTkkr2SDnAQi8-fohOn4rUinICd-pHVA&format=png&visual_refresh=true&markers=size:mid%7Ccolor:0xff0000%7Clabel:1%7C40.46434789999999,-79.926266&markers=size:mid%7Ccolor:0xff0000%7Clabel:2%7C40.459440916034,-79.922839395502&path=color:0x0000ff|weight:5|40.46446,-79.92622|40.46446,-79.92622|40.46445,-79.92618|40.46445,-79.92618|40.46428,-79.92564|40.46428,-79.92564|40.46424,-79.92551|40.46424,-79.92551|40.46417,-79.92526|40.46417,-79.92526|40.46411,-79.92502|40.46411,-79.92502|40.46404,-79.92478|40.46404,-79.92478|40.46396,-79.92447|40.46396,-79.92447|40.46382,-79.92403|40.46382,-79.92403|40.46374,-79.92377|40.46374,-79.92377|40.46374,-79.92377|40.46374,-79.92377|40.46306,-79.92409|40.46306,-79.92409|40.46271,-79.92425|40.46271,-79.92425|40.4626,-79.9243|40.4626,-79.9243|40.46247,-79.92435|40.46247,-79.92435|40.46199,-79.92458|40.46199,-79.92458|40.46174,-79.92469|40.46174,-79.92469|40.46142,-79.92483|40.46142,-79.92483|40.46142,-79.92483|40.46142,-79.92483|40.46107,-79.92382|40.46107,-79.92382|40.46102,-79.92368|40.46102,-79.92368|40.46093,-79.92345|40.46093,-79.92345|40.46089,-79.92332|40.46089,-79.92332|40.46083,-79.92318|40.46083,-79.92318|40.46078,-79.92304|40.46078,-79.92304|40.46068,-79.92275|40.46068,-79.92275|40.46059,-79.92248|40.46059,-79.92248|40.46049,-79.92218|40.46049,-79.92218|40.46036,-79.92182|40.46036,-79.92182|40.46025,-79.92173|40.46025,-79.92173|40.46025,-79.92173|40.46025,-79.92173|40.46013,-79.92183|40.46013,-79.92183|40.46,-79.92193|40.46,-79.92193|40.45999,-79.92194|40.45999,-79.92194|40.45997,-79.92196|40.45997,-79.92196|40.45996,-79.92199|40.45996,-79.92199|40.45981,-79.92262|40.45981,-79.92262|40.45981,-79.92262|40.45981,-79.92262|40.45953,-79.92233|40.45953,-79.92233|40.45951,-79.92231|40.45951,-79.92231|40.45953,-79.92219|40.45953,-79.92219|40.4595,-79.92223|40.4595,-79.92223|40.45938,-79.92273|40.45938,-79.92273|40.45938,-79.92277|40.45938,-79.92277|40.45937,-79.92281|40.45937,-79.92281"));
    }
}
